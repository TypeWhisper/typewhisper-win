<Window x:Class="TypeWhisper.Windows.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:TypeWhisper.Windows.ViewModels"
        Title="TypeWhisper"
        Width="400" Height="80"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        Topmost="True"
        ShowInTaskbar="False"
        ShowActivated="False"
        ResizeMode="NoResize"
        WindowStartupLocation="Manual"
        Focusable="False"
        Loaded="OnLoaded">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
    </Window.Resources>

    <Border CornerRadius="12"
            Background="#E0202020"
            Padding="16,8"
            Margin="4"
            Visibility="{Binding IsOverlayVisible, Converter={StaticResource BoolToVis}}">
        <Border.Effect>
            <DropShadowEffect Color="Black" BlurRadius="12" Opacity="0.5" ShadowDepth="2"/>
        </Border.Effect>

        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Status indicator -->
            <Ellipse Grid.Column="0" Width="12" Height="12" Margin="0,0,10,0"
                     VerticalAlignment="Center">
                <Ellipse.Style>
                    <Style TargetType="Ellipse">
                        <Setter Property="Fill" Value="#888"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding State}" Value="Recording">
                                <Setter Property="Fill" Value="#FF4444"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding State}" Value="Processing">
                                <Setter Property="Fill" Value="#FFaa00"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding State}" Value="Inserting">
                                <Setter Property="Fill" Value="#44cc44"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding State}" Value="Error">
                                <Setter Property="Fill" Value="#FF0000"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Ellipse.Style>
            </Ellipse>

            <!-- Status text + transcription preview -->
            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                <TextBlock Text="{Binding StatusText}"
                           Foreground="White" FontSize="13"
                           FontWeight="SemiBold"
                           TextTrimming="CharacterEllipsis"/>
                <TextBlock Text="{Binding TranscribedText}"
                           Foreground="#CCCCCC" FontSize="11"
                           TextTrimming="CharacterEllipsis"
                           MaxHeight="18"
                           Visibility="{Binding TranscribedText.Length, Converter={StaticResource BoolToVis}}"/>
            </StackPanel>

            <!-- Audio level bar -->
            <Border Grid.Column="2" Width="40" Height="8"
                    CornerRadius="4" Background="#333"
                    VerticalAlignment="Center" Margin="10,0,0,0">
                <Border CornerRadius="4" Background="#44cc44"
                        HorizontalAlignment="Left">
                    <Border.Width>
                        <MultiBinding>
                            <MultiBinding.Converter>
                                <local:AudioLevelWidthConverter xmlns:local="clr-namespace:TypeWhisper.Windows.Converters"/>
                            </MultiBinding.Converter>
                            <Binding Path="AudioLevel"/>
                            <Binding RelativeSource="{RelativeSource AncestorType=Border}" Path="ActualWidth"/>
                        </MultiBinding>
                    </Border.Width>
                </Border>
            </Border>
        </Grid>
    </Border>
</Window>
