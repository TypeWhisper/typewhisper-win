<UserControl x:Class="TypeWhisper.Windows.Views.Sections.SnippetsSection"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:conv="clr-namespace:TypeWhisper.Windows.Converters">
    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Styles/UnifiedSettingsStyles.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            <BooleanToVisibilityConverter x:Key="BoolToVis"/>
            <conv:NonEmptyToVisibilityConverter x:Key="NonEmptyToVis"/>
            <conv:TagSplitConverter x:Key="TagSplitConverter"/>
        </ResourceDictionary>
    </UserControl.Resources>

    <DockPanel Margin="24">
        <!-- Header -->
        <TextBlock DockPanel.Dock="Top" Text="Snippets" Style="{StaticResource SectionHeaderStyle}"/>
        <TextBlock DockPanel.Dock="Top"
                   Text="Platzhalter: {date}, {time}, {datetime}, {day}, {year}, {clipboard}, {date:FORMAT}"
                   Style="{StaticResource HintStyle}" Margin="0,0,0,12"/>

        <!-- Toolbar -->
        <Grid DockPanel.Dock="Top" Margin="0,0,0,12">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <TextBlock Grid.Column="0" Text="Tag-Filter:" Foreground="#808080" FontSize="12"
                       VerticalAlignment="Center" Margin="0,0,6,0"/>
            <ComboBox Grid.Column="1" Width="130"
                      Style="{StaticResource InputComboBoxStyle}"
                      ItemContainerStyle="{StaticResource InputComboBoxItemStyle}"
                      SelectedItem="{Binding Snippets.SelectedTagFilter}"
                      ItemsSource="{Binding Snippets.AvailableTags}"
                      IsEditable="False"/>
            <Button Grid.Column="2" Content="Alle" Margin="6,0,0,0"
                    Style="{StaticResource LinkButtonStyle}"
                    Command="{Binding Snippets.ClearTagFilterCommand}"
                    Visibility="{Binding Snippets.SelectedTagFilter, Converter={StaticResource NonEmptyToVis}}"/>

            <Button Grid.Column="4" Content="Import"
                    Command="{Binding Snippets.ImportSnippetsCommand}"
                    Style="{StaticResource SecondaryButtonStyle}" Padding="12,6" Margin="0,0,4,0"/>
            <Button Grid.Column="5" Content="Export"
                    Command="{Binding Snippets.ExportSnippetsCommand}"
                    Style="{StaticResource SecondaryButtonStyle}" Padding="12,6" Margin="0,0,4,0"/>
            <Button Grid.Column="6" Content="+ Neu"
                    Command="{Binding Snippets.StartCreateCommand}"
                    Style="{StaticResource PrimaryButtonStyle}" Padding="12,6"/>
        </Grid>

        <!-- Empty State (shown via code-behind) -->
        <StackPanel x:Name="EmptyState" VerticalAlignment="Center" HorizontalAlignment="Center"
                    Visibility="Collapsed">
            <TextBlock Text="Noch keine Snippets vorhanden."
                       Foreground="#808080" FontSize="14" HorizontalAlignment="Center" Margin="0,0,0,12"/>
            <Button Content="+ Erstes Snippet erstellen"
                    Command="{Binding Snippets.StartCreateCommand}"
                    Style="{StaticResource PrimaryButtonStyle}" Padding="16,8"
                    HorizontalAlignment="Center"/>
        </StackPanel>

        <!-- Snippet List -->
        <ScrollViewer x:Name="SnippetList" VerticalScrollBarVisibility="Auto">
            <ItemsControl ItemsSource="{Binding Snippets.Snippets}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Style="{StaticResource TimelineCardStyle}" Margin="0,0,0,6"
                                MouseLeftButtonDown="Card_MouseLeftButtonDown">
                            <Border.ContextMenu>
                                <ContextMenu>
                                    <MenuItem Header="Bearbeiten" Click="ContextEdit_Click"/>
                                    <MenuItem Header="Löschen" Click="ContextDelete_Click"/>
                                </ContextMenu>
                            </Border.ContextMenu>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- Trigger (monospace, accent) -->
                                <TextBlock Grid.Column="0" Text="{Binding Trigger}"
                                           FontFamily="Consolas" FontSize="13"
                                           Foreground="{StaticResource AccentBrush}"
                                           VerticalAlignment="Center"
                                           MinWidth="80"/>

                                <!-- Arrow -->
                                <TextBlock Grid.Column="1" Text="→" Foreground="#808080"
                                           VerticalAlignment="Center" FontSize="12" Margin="8,0"/>

                                <!-- Replacement + Tags -->
                                <StackPanel Grid.Column="2" Margin="0,0,8,0" VerticalAlignment="Center">
                                    <TextBlock Text="{Binding Replacement}"
                                               Foreground="{StaticResource TextBrush}"
                                               FontSize="13" TextTrimming="CharacterEllipsis"
                                               MaxHeight="20"/>
                                    <!-- Tag badges -->
                                    <ItemsControl ItemsSource="{Binding Tags, Converter={StaticResource TagSplitConverter}}"
                                                  Margin="0,3,0,0"
                                                  Visibility="{Binding Tags, Converter={StaticResource NonEmptyToVis}}">
                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <WrapPanel/>
                                            </ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border Style="{StaticResource BadgeStyle}">
                                                    <TextBlock Text="{Binding}" Foreground="#CCCCCC" FontSize="10"/>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>

                                <!-- Badges: CaseSensitive -->
                                <Border Grid.Column="3" Style="{StaticResource BadgeStyle}"
                                        VerticalAlignment="Center"
                                        Visibility="{Binding CaseSensitive, Converter={StaticResource BoolToVis}}">
                                    <TextBlock Text="Aa" Foreground="#CCCCCC" FontSize="10" FontWeight="SemiBold"/>
                                </Border>

                                <!-- Toggle Enabled -->
                                <CheckBox Grid.Column="4" IsChecked="{Binding IsEnabled, Mode=OneWay}"
                                          Style="{StaticResource InputCheckBoxStyle}"
                                          VerticalAlignment="Center" Margin="8,0,0,0"
                                          Click="ToggleEnabled_Click"/>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>
    </DockPanel>
</UserControl>
