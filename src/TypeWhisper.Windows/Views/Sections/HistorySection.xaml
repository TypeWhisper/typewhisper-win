<UserControl x:Class="TypeWhisper.Windows.Views.Sections.HistorySection"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Styles/UnifiedSettingsStyles.xaml"/>
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </UserControl.Resources>

    <DockPanel Margin="24">
        <TextBlock DockPanel.Dock="Top" Text="Verlauf" Style="{StaticResource SectionHeaderStyle}"/>

        <!-- Top: Search + Stats -->
        <Grid DockPanel.Dock="Top" Margin="0,0,0,12">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <TextBox Grid.Column="0" Text="{Binding History.SearchQuery, UpdateSourceTrigger=PropertyChanged}"
                     Style="{StaticResource InputTextBoxStyle}" Margin="0,0,8,0"/>
            <TextBlock Grid.Column="1" VerticalAlignment="Center" Foreground="{StaticResource HintBrush}" Margin="0,0,12,0">
                <Run Text="{Binding History.TotalRecords, Mode=OneWay}"/> Einträge,
                <Run Text="{Binding History.TotalWords, Mode=OneWay}"/> Wörter
            </TextBlock>
            <Button Grid.Column="2" Content="Alle löschen" Command="{Binding History.ClearAllCommand}"
                    Style="{StaticResource DangerButtonStyle}" Padding="12,6"/>
        </Grid>

        <!-- Right: Detail panel -->
        <Border DockPanel.Dock="Right" Width="280" Margin="12,0,0,0"
                Background="{StaticResource InputBackgroundBrush}"
                BorderBrush="{StaticResource BorderBrush}" BorderThickness="1" CornerRadius="8" Padding="12">
            <ScrollViewer>
                <StackPanel DataContext="{Binding History.SelectedRecord}">
                    <TextBlock Text="Details" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,8"
                               Foreground="{StaticResource TextBrush}"/>
                    <TextBlock Text="{Binding Timestamp, StringFormat='{}{0:dd.MM.yyyy HH:mm}'}" Foreground="{StaticResource HintBrush}"/>
                    <TextBlock Text="{Binding AppName}" Foreground="{StaticResource HintBrush}" Margin="0,2,0,0"/>
                    <TextBlock Text="{Binding Language}" Foreground="{StaticResource HintBrush}" Margin="0,2,0,0"/>
                    <TextBlock Text="{Binding DurationSeconds, StringFormat='{}{0:F1}s'}" Foreground="{StaticResource HintBrush}" Margin="0,2,0,8"/>

                    <TextBlock Text="Text:" FontWeight="SemiBold" Margin="0,4,0,4" Foreground="{StaticResource LabelBrush}"/>
                    <TextBox Text="{Binding FinalText, Mode=OneWay}" IsReadOnly="True"
                             TextWrapping="Wrap" AcceptsReturn="True"
                             Style="{StaticResource InputTextBoxStyle}"
                             MinHeight="80" MaxHeight="200"/>

                    <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                        <Button Content="Kopieren"
                                Command="{Binding DataContext.History.CopyToClipboardCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                Style="{StaticResource SecondaryButtonStyle}" Padding="12,6" Margin="0,0,4,0"/>
                        <Button Content="Löschen"
                                Command="{Binding DataContext.History.DeleteRecordCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                Style="{StaticResource DangerButtonStyle}" Padding="12,6"/>
                    </StackPanel>
                </StackPanel>
            </ScrollViewer>
        </Border>

        <!-- Center: List -->
        <DataGrid ItemsSource="{Binding History.Records}"
                  SelectedItem="{Binding History.SelectedRecord}"
                  AutoGenerateColumns="False" IsReadOnly="True"
                  CanUserAddRows="False" CanUserDeleteRows="False"
                  SelectionMode="Single"
                  Style="{StaticResource DarkDataGridStyle}"
                  ColumnHeaderStyle="{StaticResource DarkDataGridColumnHeaderStyle}"
                  CellStyle="{StaticResource DarkDataGridCellStyle}"
                  RowStyle="{StaticResource DarkDataGridRowStyle}">
            <DataGrid.Columns>
                <DataGridTextColumn Header="Zeit" Binding="{Binding Timestamp, StringFormat='{}{0:dd.MM HH:mm}'}" Width="90"/>
                <DataGridTextColumn Header="Text" Binding="{Binding Preview}" Width="*"/>
                <DataGridTextColumn Header="App" Binding="{Binding AppProcessName}" Width="100"/>
                <DataGridTextColumn Header="Dauer" Binding="{Binding DurationSeconds, StringFormat='{}{0:F1}s'}" Width="55"/>
                <DataGridTextColumn Header="Wörter" Binding="{Binding WordCount}" Width="55"/>
            </DataGrid.Columns>
        </DataGrid>
    </DockPanel>
</UserControl>
